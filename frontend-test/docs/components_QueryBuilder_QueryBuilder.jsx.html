<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: components/QueryBuilder/QueryBuilder.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: components/QueryBuilder/QueryBuilder.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { useRef } from 'react'
import ColumnSelection from './ColumnSelection/ColumnSelection'
import Conditions from './Conditions/Conditions'
import TerminationClause from './TerminationClause/TerminationClause'
import { sendQuery } from '../../service/postQuery'
import { useData } from '../../context/DataContext'

/**
 * Component that builds the query and sends it to the context
 * @component
 */
function QueryBuilder () {
  const { setAppData } = useData()

  const columnSelectionRef = useRef()
  const conditionRef = useRef()
  const terminationClauseRef = useRef()

  /**
   * Gets the values from the components and builds the query to send it to the context
   */
  const handleBuildQuery = async () => {
    const columnSelectionValue = columnSelectionRef.current.getValue()
    const conditionResult = conditionRef.current.getValues()
    const terminationClauseResult = terminationClauseRef.current.getValues()

    const conditionValues = Object.entries(conditionResult).map(([columnName, condition]) => {
      if (typeof condition === 'object') {
        // For complex conditions (with operators and values)
        if (typeof condition.value === 'number') {
          return `${columnName} ${condition.operator} ${condition.value}`
        }
        return `${columnName} ${condition.operator} '${condition.value}'`
      } else {
        // For simple conditions (with values only)
        return `${columnName} = '${condition}'`
      }
    })

    // Add WHERE clause if there are conditions
    const whereClause = conditionValues.length > 0 ? `WHERE ${conditionValues.join(' AND ')}` : ''

    // Add ORDER BY clause if there is a termination clause
    const terminationValues = Object.entries(terminationClauseResult).map(([columnName, clause]) => {
      if (columnName === 'orderBy') {
        return `ORDER BY ${clause}`
      } else {
        return `${columnName} ${clause}`
      }
    })

    const terminationClause = terminationValues.length > 0 ? `${terminationValues.join(' ')}` : ''

    const query = `SELECT ${columnSelectionValue} FROM bigquery-public-data.google_trends.top_terms ${whereClause} ${terminationClause}`

    const response = await sendQuery(query, columnSelectionValue)
    setAppData(response)
  }

  return (
    &lt;>
      &lt;ColumnSelection ref={columnSelectionRef} />
      &lt;Conditions ref={conditionRef} />
      &lt;TerminationClause ref={terminationClauseRef} />

      &lt;button onClick={handleBuildQuery}> Build Query &lt;/button>
    &lt;/>
  )
}

export default QueryBuilder
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#ChartSection">ChartSection</a></li><li><a href="global.html#ColumnSelection">ColumnSelection</a></li><li><a href="global.html#Conditions">Conditions</a></li><li><a href="global.html#QueryBuilder">QueryBuilder</a></li><li><a href="global.html#SaveModal">SaveModal</a></li><li><a href="global.html#SaveSection">SaveSection</a></li><li><a href="global.html#SavedQueries">SavedQueries</a></li><li><a href="global.html#TerminationClause">TerminationClause</a></li><li><a href="global.html#getUsers">getUsers</a></li><li><a href="global.html#sendQuery">sendQuery</a></li><li><a href="global.html#sendUser">sendUser</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Tue Nov 21 2023 13:45:39 GMT-0500 (Colombia Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
